trigger: none

pr:
- master

pool:
  vmImage: 'Ubuntu-18.04'

resources:
  repositories:
  - repository: templates
    type: github
    name: swellaby/azure-pipelines-templates
    endpoint: swellaby

steps:
- template: '../steps/run-tests.yml'
  parameters:
    envName: 'Linux'
# - template: templates/yml/node/combo/npm-build-validation-xunit-cobertura.yml@templates
#   parameters:
#     runNpmBuildScript:
#       buildNpmScriptName: 'test'
#       taskDisplayName: 'Enforce code coverage'
#     publishTestResults:
#       taskDisplayName: 'Publish unit test results'
#       testResultsFormat: 'JUnit'
#       testResultsFiles: 'test-results.xml'
#       searchFolder: '$(Build.SourcesDirectory)/.test-results'
#       testRunTitle: 'vsts-mirror-git-repository::Unit Tests::Linux PR - Build $(Build.BuildId)'
#     publishCoverage:
#       taskDisplayName: 'Publish coverage results'
#       codeCoverageTool: 'Cobertura'
#       summaryFileLocation: '$(Build.SourcesDirectory)/.coverage/cobertura-coverage.xml'
#       reportDirectory: '$(Build.SourcesDirectory)/.coverage'
#       additionalCodeCoverageFiles: ''
#       failIfCoverageEmpty: false

- script: |
    bash <(curl -s https://codecov.io/bash) -t $(codecovToken)
  displayName: 'Publish coverage to Codecov'
